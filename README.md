# SafeCommunity
å¹³å®‰ç¤¾åŒºâ€”â€”åŸºäºYoLov5çš„ç¤¾åŒºç›‘æ§å¹³å°

è§†é¢‘äº†è§£å…·ä½“ç»†èŠ‚å¯çœ‹å“”ç«™

https://www.bilibili.com/video/BV1PS421P7iV/?spm_id_from=333.1007.top_right_bar_window_history.content.click

æºç åŠ vx: is_MrSun_work

é‚®ç®±ï¼šismr_sun@163.com

# ä¸€ã€é¡¹ç›®ä»‹ç»
>&emsp;ç«ç„°ç»™äººç±»å¸¦æ¥äº†è®¸å¤šç›Šå¤„ï¼Œå¯¹ç«çš„åˆç†åˆ©ç”¨æ˜¯ä¿ƒè¿›äººç±»ç¤¾ä¼šå‘å±•çš„ä¸€ä¸ªé‡è¦å› ç´ ï¼Œä½†ä½¿ç”¨ä¸æ…å°±ä¼šé€ æˆç«ç¾ã€‚æ®ä¸­å›½åº”æ€¥ç®¡ç†éƒ¨æ¶ˆé˜²æ•‘æ´å±€ç»Ÿè®¡ï¼Œ2022å¹´1è‡³9æœˆï¼Œå…¨å›½å…±æ¥æŠ¥ç«ç¾63.68ä¸‡èµ·ï¼Œæ­»äº¡1441äººï¼Œå—ä¼¤1640äººï¼Œç›´æ¥è´¢äº§æŸå¤±55äº¿å…ƒäººæ°‘å¸ã€‚ä»èµ·ç«åœºæ‰€çœ‹ï¼Œå±…ä½åœºæ‰€å‘ç”Ÿç«ç¾22.38ä¸‡èµ·ã€æ­»äº¡1061äººï¼Œåˆ†åˆ«å ç«ç¾æ€»æ•°å’Œæ­»äº¡äººæ€»æ•°çš„35.15%ã€73.63%ï¼›å…¶ä¸­ï¼Œè¾ƒå¤§ç«ç¾45èµ·ï¼Œå å…¨éƒ¨è¾ƒå¤§ç«ç¾èµ·æ•°çš„56.25%ã€‚å› æ­¤ï¼Œèƒ½å¤ŸåŠæ—¶å‘ç°ç«æƒ…å¹¶åšå‡ºååº”ï¼Œå¯¹äºç»´æŠ¤äººæ°‘çš„äººèº«è´¢äº§å®‰å…¨å…·æœ‰é‡å¤§æ„ä¹‰ã€‚

&emsp;&emsp;æœ¬é¡¹ç›®é‡‡ç”¨åŸºäºYOLOv5çš„æ£€æµ‹æ¨¡å‹è¿›è¡Œç«ç¾æ¢æµ‹æ–¹æ³•ï¼Œç»“åˆä¼ ç»Ÿç›‘æ§åŠç¤¾åŒºä¿¡æ¯ç®¡ç†å¹³å°ï¼Œå®ç°å¯¹ç¤¾åŒºå¯ç›‘è§†èŒƒå›´å†…çš„ç«æƒ…ç›‘æµ‹ï¼Œå¹¶åŠæ—¶åé¦ˆç»™ç›¸å…³äººå‘˜ï¼Œä¸ºå…¶æä¾›ç«æƒ…çš„è¯¦ç»†ä¿¡æ¯å¦‚ç›‘æ§ç”»é¢ã€å¤§è‡´ä½ç½®åŠé™„è¿‘æ¶ˆé˜²è®¾å¤‡ä¿¡æ¯ç­‰ï¼Œä¸ºåŠæ—¶æ‰‘ç­ç«æƒ…æä¾›å¸®åŠ©ã€‚

# äºŒã€é¡¹ç›®ç»“æ„
## 1ã€é¡¹ç›®ç»“æ„å›¾
![img.png](ReadMeImages/ProjectStructure.png)
## 2ã€é¡¹ç›®ç»“æ„è¯´æ˜
    |safecommunity
        |PushFlowUtil                                   //æ¨æµçš„å·¥å…·ä¸æœåŠ¡å™¨
        |src
            |main
                |java
                    |com
                        |mrsun
                            |common                     //å…¬å…±éƒ¨åˆ†
                            |config                     //å„ç§é…ç½®æ–‡ä»¶
                            |controller                 //æ§åˆ¶è®¿é—®å±‚
                            |entity                     //å®ä½“ç±»
                                |util                   //å·¥å…·å®ä½“ç±»ï¼Œåœ¨åšä¸€äº›æ“ä½œæ—¶ï¼Œè¿›è¡Œæ•°æ®å°è£…
                                |vo                     //è§†å›¾ç±» ä½œä¸ºæœ€ç»ˆè¿”å›ç»™å‰ç«¯çš„æ•°æ®
                            |firemonitoring             //ç«æƒ…ç›‘æµ‹éƒ¨åˆ†
                            |interceptor                //æ‹¦æˆªå™¨
                            |logger                     //æ—¥å¿—è®°å½•aop
                            |mapper                     //daoå±‚
                            |result                     //è¿”å›ç»“æœå°è£…
                            |service                    //ä¸šåŠ¡é€»è¾‘å±‚
                            |util                       //å·¥å…·åŒ…
                            |MainApplication            //å¯åŠ¨ç±»
                |resources          
                    |dailyHistoricalVideo               //æ¯æ—¥è§†é¢‘å›æ”¾å­˜å‚¨ä½ç½®,å®é™…åº”è¯¥æ”¾åœ¨æœåŠ¡å™¨ä¸­
                    |detection                          //ç«ç„°æ£€æµ‹éƒ¨åˆ†
                        |input                          //æ£€æµ‹éœ€è¦çš„è¾“å…¥
                            |images                     //è¢«æ£€æµ‹å›¾ç‰‡å­˜æ”¾ä½ç½®
                        |out                            //åŸæœ¬æ£€æµ‹çš„è¾“å‡ºç›®å½•
                    |fireHistoricalVideo                //å‘ç”Ÿç«ç¾æ—¶ï¼Œæˆªå–è§†é¢‘çš„å­˜æ”¾ä½ç½®,å®é™…åº”è¯¥æ”¾åœ¨æœåŠ¡å™¨ä¸­
                    |mapper                             //daoå±‚mapperçš„xmlæ–‡ä»¶
                    |static                             //é™æ€èµ„æºï¼Œå­˜æ”¾å‰ç«¯é¡µé¢æ‰€éœ€èµ„æº
                    |systemTestData                     //ç³»ç»Ÿæµ‹è¯•æ•°æ®ï¼ŒåŒ…å«æ¨æµçš„è§†é¢‘ä»¥åŠæ‰¹é‡å¯¼å…¥çš„csvæ–‡ä»¶
                    |templates                          //å‰ç«¯é¡µé¢
                        |bigscreen.html                 //ç›‘æ§å¤§å±é¡µ
                        |fzrxx.html                     //ç«æƒ…è´Ÿè´£äººé¡µ
                        |homepage.html                  //é¦–é¡µ
                        |index.html                     //æœ‰åšæµ‹è¯•è§†é¢‘æ‹‰æµæ’­æ”¾çš„é¡µé¢ï¼Œæ— ç”¨
                        |login.html                     //ç™»å½•é¡µ
                        |lsjkxx.html                    //å†å²ç›‘æ§é¡µ
                        |main.html                      //å·¦ä¾§èœå•æ 
                        |rzxx.html                      //æ—¥å¿—é¡µ
                        |sbxx.html                      //ç›‘æ§è®¾å¤‡é¡µ
                        |searchvideo.html               //å›æ”¾è§†é¢‘æ’­æ”¾çª—å£é¡µ
                        |searchvideo-bigscreen.html     //ç›‘æ§å¤§å±è§†é¢‘æ’­æ”¾çª—å£é¡µ
                        |xfsbxx.html                    //æ¶ˆé˜²è®¾å¤‡é¡µ
                        |xqxx.html                      //å°åŒºä¿¡æ¯é¡µï¼ˆä½å®…ä¿¡æ¯ï¼‰

# ä¸‰ã€ç›¸å…³æŠ€æœ¯
## 1ã€å‰ç«¯æ¡†æ¶
### (1) BootStrap
> Bootstrapï¼Œæ¥è‡ª Twitterï¼Œæ˜¯ç›®å‰æœ€å—æ¬¢è¿çš„å‰ç«¯æ¡†æ¶ã€‚Bootstrap æ˜¯åŸºäº HTMLã€CSSã€JAVASCRIPT çš„ï¼Œå®ƒç®€æ´çµæ´»ï¼Œä½¿å¾— Web å¼€å‘æ›´åŠ å¿«æ·ã€‚[å®˜æ–¹æ–‡æ¡£](https://www.bootcss.com/)
### (2) JQuery
> jQueryæ˜¯ä¸€ä¸ªå¿«é€Ÿã€ç®€æ´çš„JavaScriptæ¡†æ¶ï¼Œæ˜¯ç»§Prototypeä¹‹ååˆä¸€ä¸ªä¼˜ç§€çš„JavaScriptä»£ç åº“ï¼ˆæ¡†æ¶ï¼‰[ä¸­æ–‡æ–‡æ¡£](https://jquery.cuishifeng.cn/)
### (3) Vue(é¡¹ç›®ä¸­ä½¿ç”¨è¾ƒå°‘)
> Vue (å‘éŸ³ä¸º /vjuË/ï¼Œç±»ä¼¼ view) æ˜¯ä¸€æ¬¾ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„ JavaScript æ¡†æ¶ã€‚å®ƒåŸºäºæ ‡å‡† HTMLã€CSS å’Œ JavaScript æ„å»ºï¼Œå¹¶æä¾›äº†ä¸€å¥—å£°æ˜å¼çš„ã€ç»„ä»¶åŒ–çš„ç¼–ç¨‹æ¨¡å‹ï¼Œå¸®åŠ©ä½ é«˜æ•ˆåœ°å¼€å‘ç”¨æˆ·ç•Œé¢ã€‚æ— è®ºæ˜¯ç®€å•è¿˜æ˜¯å¤æ‚çš„ç•Œé¢ï¼ŒVue éƒ½å¯ä»¥èƒœä»»ã€‚[å®˜æ–¹æ–‡æ¡£](https://cn.vuejs.org/guide/introduction.html)
## 2ã€åç«¯æ¡†æ¶
### (1) SpringBoot
> Spring Bootæ˜¯ç”±Pivotalå›¢é˜Ÿæä¾›çš„ä¸€å¥—å¼€æºæ¡†æ¶ï¼Œå¯ä»¥ç®€åŒ–springåº”ç”¨çš„åˆ›å»ºåŠéƒ¨ç½²ã€‚å®ƒæä¾›äº†ä¸°å¯Œçš„Springæ¨¡å—åŒ–æ”¯æŒï¼Œå¯ä»¥å¸®åŠ©å¼€å‘è€…æ›´è½»æ¾å¿«æ·åœ°æ„å»ºå‡ºä¼ä¸šçº§åº”ç”¨ã€‚Spring Booté€šè¿‡è‡ªåŠ¨é…ç½®åŠŸèƒ½ï¼Œé™ä½äº†å¤æ‚æ€§ï¼ŒåŒæ—¶æ”¯æŒåŸºäºJVMçš„å¤šç§å¼€æºæ¡†æ¶ï¼Œå¯ä»¥ç¼©çŸ­å¼€å‘æ—¶é—´ï¼Œä½¿å¼€å‘æ›´åŠ ç®€å•å’Œé«˜æ•ˆã€‚[ä¸­æ–‡æ–‡æ¡£](https://springdoc.cn/spring-boot/)
### (2) WebSocket
> WebSocket æ˜¯ HTML5 å¼€å§‹æä¾›çš„ä¸€ç§åœ¨å•ä¸ª TCP è¿æ¥ä¸Šè¿›è¡Œå…¨åŒå·¥é€šè®¯çš„åè®®ã€‚WebSocket ä½¿å¾—å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®äº¤æ¢å˜å¾—æ›´åŠ ç®€å•ï¼Œå…è®¸æœåŠ¡ç«¯ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€æ•°æ®ã€‚åœ¨ WebSocket API ä¸­ï¼Œæµè§ˆå™¨å’ŒæœåŠ¡å™¨åªéœ€è¦å®Œæˆä¸€æ¬¡æ¡æ‰‹ï¼Œä¸¤è€…ä¹‹é—´å°±ç›´æ¥å¯ä»¥åˆ›å»ºæŒä¹…æ€§çš„è¿æ¥ï¼Œå¹¶è¿›è¡ŒåŒå‘æ•°æ®ä¼ è¾“ã€‚
åœ¨ WebSocket API ä¸­ï¼Œæµè§ˆå™¨å’ŒæœåŠ¡å™¨åªéœ€è¦åšä¸€ä¸ªæ¡æ‰‹çš„åŠ¨ä½œï¼Œç„¶åï¼Œæµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´å°±å½¢æˆäº†ä¸€æ¡å¿«é€Ÿé€šé“ã€‚ä¸¤è€…ä¹‹é—´å°±ç›´æ¥å¯ä»¥æ•°æ®äº’ç›¸ä¼ é€ã€‚ ç°åœ¨ï¼Œå¾ˆå¤šç½‘ç«™ä¸ºäº†å®ç°æ¨é€æŠ€æœ¯ï¼Œæ‰€ç”¨çš„æŠ€æœ¯éƒ½æ˜¯ Ajax è½®è¯¢ã€‚è½®è¯¢æ˜¯åœ¨ç‰¹å®šçš„çš„æ—¶é—´é—´éš”ï¼ˆå¦‚æ¯1ç§’ï¼‰ï¼Œç”±æµè§ˆå™¨å¯¹æœåŠ¡å™¨å‘å‡ºHTTPè¯·æ±‚ï¼Œç„¶åç”±æœåŠ¡å™¨è¿”å›æœ€æ–°çš„æ•°æ®ç»™å®¢æˆ·ç«¯çš„æµè§ˆå™¨ã€‚è¿™ç§ä¼ ç»Ÿçš„æ¨¡å¼å¸¦æ¥å¾ˆæ˜æ˜¾çš„ç¼ºç‚¹ï¼Œå³æµè§ˆå™¨éœ€è¦ä¸æ–­çš„å‘æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œç„¶è€ŒHTTPè¯·æ±‚å¯èƒ½åŒ…å«è¾ƒé•¿çš„å¤´éƒ¨ï¼Œå…¶ä¸­çœŸæ­£æœ‰æ•ˆçš„æ•°æ®å¯èƒ½åªæ˜¯å¾ˆå°çš„ä¸€éƒ¨åˆ†ï¼Œæ˜¾ç„¶è¿™æ ·ä¼šæµªè´¹å¾ˆå¤šçš„å¸¦å®½ç­‰èµ„æºã€‚HTML5 å®šä¹‰çš„WebSocketåè®®ï¼Œèƒ½æ›´å¥½çš„èŠ‚çœæœåŠ¡å™¨èµ„æºå’Œå¸¦å®½ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ›´å®æ—¶åœ°è¿›è¡Œé€šè®¯ã€‚

&emsp;**æœ¬é¡¹ç›®ä¸­ï¼Œç”¨æ¥å®ç°åç«¯ä¸»åŠ¨å‘å‰ç«¯æŠ¥è­¦ã€‚**

## 3ã€æ•°æ®åº“
### (1) MySQl
> MySQL æ˜¯æœ€æµè¡Œçš„å…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼Œåœ¨ WEB åº”ç”¨æ–¹é¢ MySQL æ˜¯æœ€å¥½çš„ RDBMS(Relational Database Management Systemï¼šå…³ç³»æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ)åº”ç”¨è½¯ä»¶ä¹‹ä¸€ã€‚

&emsp;**æœ¬é¡¹ç›®ä¸­ï¼Œä½œä¸ºä¸»è¦æ•°æ®å­˜å‚¨æ–¹å¼ã€‚**

### (2) Redis
>REmote DIctionary Server(Redis) æ˜¯ä¸€ä¸ªç”± Salvatore Sanfilippo å†™çš„ key-value å­˜å‚¨ç³»ç»Ÿï¼Œæ˜¯è·¨å¹³å°çš„éå…³ç³»å‹æ•°æ®åº“ã€‚Redis æ˜¯ä¸€ä¸ªå¼€æºçš„ä½¿ç”¨ ANSI C è¯­è¨€ç¼–å†™ã€éµå®ˆ BSD åè®®ã€æ”¯æŒç½‘ç»œã€å¯åŸºäºå†…å­˜ã€åˆ†å¸ƒå¼ã€å¯é€‰æŒä¹…æ€§çš„é”®å€¼å¯¹(Key-Value)å­˜å‚¨æ•°æ®åº“ï¼Œå¹¶æä¾›å¤šç§è¯­è¨€çš„ APIã€‚ Redis é€šå¸¸è¢«ç§°ä¸ºæ•°æ®ç»“æ„æœåŠ¡å™¨ï¼Œå› ä¸ºå€¼ï¼ˆvalueï¼‰å¯ä»¥æ˜¯å­—ç¬¦ä¸²(String)ã€å“ˆå¸Œ(Hash)ã€åˆ—è¡¨(list)ã€é›†åˆ(sets)å’Œæœ‰åºé›†åˆ(sorted sets)ç­‰ç±»å‹ã€‚

&emsp;**æœ¬é¡¹ç›®ä¸­ï¼Œç”¨æ¥å­˜å‚¨éªŒè¯ç çš„ä¿¡æ¯ï¼Œä¸ç”¨ä½œä¸»è¦æ•°æ®çš„å­˜å‚¨ã€‚**

### (3) MyBatis-Plus
> MyBatis-Plus (opens new window)ï¼ˆç®€ç§° MPï¼‰æ˜¯ä¸€ä¸ª MyBatis (opens new window)çš„å¢å¼ºå·¥å…·ï¼Œåœ¨ MyBatis çš„åŸºç¡€ä¸Šåªåšå¢å¼ºä¸åšæ”¹å˜ï¼Œä¸ºç®€åŒ–å¼€å‘ã€æé«˜æ•ˆç‡è€Œç”Ÿã€‚[å®˜æ–¹æ–‡æ¡£](https://baomidou.com/pages/24112f/)

&emsp;**æœ¬é¡¹ç›®ä¸­ï¼Œè¿æ¥æ•°æ®åº“ï¼Œå®Œæˆå„ç§CRUD,ä½¿ç”¨MyBatis-Pluså¯ä»¥æé«˜å¼€å‘æ•ˆç‡ï¼Œæ— éœ€å¯¹å•è¡¨è¿›è¡ŒSQLç¼–å†™ã€‚**

## 4ã€ç«ç„°æ£€æµ‹
### (1) YOLOv5
> YOLOv5 ğŸš€ æ˜¯ä¸–ç•Œä¸Šæœ€å—æ¬¢è¿çš„è§†è§‰ AIï¼Œä»£è¡¨ Ultralytics å¯¹æœªæ¥è§†è§‰ AI æ–¹æ³•çš„å¼€æºç ”ç©¶ï¼Œç»“åˆåœ¨æ•°åƒå°æ—¶çš„ç ”ç©¶å’Œå¼€å‘ä¸­ç§¯ç´¯çš„ç»éªŒæ•™è®­å’Œæœ€ä½³å®è·µã€‚[GitHub](https://github.com/ultralytics/yolov5/blob/master/README.zh-CN.md)

&emsp;**æœ¬é¡¹ç›®ä¸­ï¼Œä½¿ç”¨å®˜æ–¹æ¨¡å‹ä½¿ç”¨Pythonè¿›è¡Œè®­ç»ƒï¼Œè®­ç»ƒåå¾—åˆ°æ¨¡å‹ã€‚**

### (2) DJL
> Deep Java Library(DJL)æ˜¯ä¸€ä¸ªå¼€æºçš„æ·±åº¦å­¦ä¹ å¼€å‘åŒ…ã€‚é€šè¿‡DJLï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨Javaæ¥è®­ç»ƒå’Œéƒ¨ç½²æ·±åº¦å­¦ä¹ æ¨¡å‹ã€‚DJLæä¾›äº†ç®€æ´çš„APIï¼Œç®€åŒ–äº†Javaå¼€å‘äººå‘˜ä¸Šæ‰‹æ·±åº¦å­¦ä¹ çš„è¿‡ç¨‹ã€‚[å®˜æ–¹ç¤ºä¾‹](https://aws.amazon.com/cn/blogs/china/use-spring-boot-and-djl-deep-java-library-to-easily-build-enterprise-level-machine-learning-microservices/)

&emsp;**æœ¬é¡¹ç›®ä¸­ï¼Œé€šè¿‡DJL apiå®ç°å¯¹è®­ç»ƒåçš„æ¨¡å‹åœ¨SpringBootä¸­çš„è°ƒç”¨ã€‚**

## 4ã€è§†é¢‘æµ
### (1) FFmpeg
> ä¸€ä¸ªå®Œæ•´çš„ï¼Œè·¨å¹³å°çš„è§£å†³æ–¹æ¡ˆï¼Œè®°å½•ï¼Œè½¬æ¢å’Œæµåª’ä½“éŸ³é¢‘å’Œè§†é¢‘ã€‚FFmpeg æ˜¯é¢†å…ˆçš„å¤šåª’ä½“æ¡†æ¶ï¼Œèƒ½å¤Ÿè§£ç ã€ç¼–ç ã€ è½¬ç ã€å¤ç”¨ã€è§£å¤ç”¨ã€æµã€è¿‡æ»¤å’Œæ’­æ”¾ å‡ ä¹æ‰€æœ‰äººç±»å’Œæœºå™¨åˆ›å»ºçš„ä¸œè¥¿ã€‚å®ƒæ”¯æŒæœ€æ¨¡ç³Šçš„å¤è€æ ¼å¼ï¼Œç›´åˆ°æœ€å‰æ²¿ã€‚æ— è®ºå®ƒä»¬æ˜¯ç”±æŸä¸ªæ ‡å‡†å§”å‘˜ä¼šã€ç¤¾åŒºè¿˜æ˜¯å…¬å¸è®¾è®¡çš„ã€‚å®ƒè¿˜å…·æœ‰é«˜åº¦çš„å¯ç§»æ¤æ€§ï¼šFFmpeg åœ¨å„ç§æ„å»ºç¯å¢ƒã€æœºå™¨æ¶æ„å’Œé…ç½®ä¸‹è·¨ Linuxã€Mac OS Xã€Microsoft Windowsã€BSDã€Solaris ç­‰ ç¼–è¯‘ã€è¿è¡Œå’Œé€šè¿‡æˆ‘ä»¬çš„æµ‹è¯•åŸºç¡€æ¶æ„ FATE ã€‚[ä¸­æ–‡æ–‡æ¡£](http://ffmpeg.p2hp.com/)

&emsp;**æœ¬é¡¹ç›®ä¸­ï¼Œä½¿ç”¨ffmpegå®ç°æœ¬åœ°è§†é¢‘ã€æ‘„åƒå¤´æ¨æµï¼Œå¾—åˆ°rtmpè§†é¢‘æµåœ°å€ï¼Œæ¨¡æ‹ŸçœŸå®å¼€å‘ç¯å¢ƒï¼›åˆ©ç”¨ffmpegå®ç°å¯¹è§†é¢‘æµçš„æˆªå–å›¾ç‰‡ã€æˆªå–è§†é¢‘ã€‚**

### (2) rtsp-simple-server
> ä¸€ä¸ªæ”¯æŒæ”¶å–è§†é¢‘æµå’Œè½¬å‘è§†é¢‘æµçš„æœåŠ¡å™¨ï¼ŒååŠ©ffmpegå®ç°æœ¬åœ°è§†é¢‘ã€æ‘„åƒå¤´è§†é¢‘æµçš„æ¨æµå’Œæ‹‰å–ã€‚

## 5ã€é’‰é’‰æŠ¥è­¦
> å®ç°åœ¨é’‰é’‰ç¾¤ä¸­æŠ¥è­¦åŠŸèƒ½ã€‚(ä½¿ç”¨æ—¶éœ€è¦ä¿®æ”¹DingDingUtilä¸­çš„å¯†é’¥å’Œtokenä¸ºè‡ªå·±ç”³è¯·å¯†é’¥å’Œtoken) [å®˜æ–¹ä½¿ç”¨æ–‡æ¡£](https://open.dingtalk.com/document/orgapp/monitoring-and-alerting)

# å››ã€é¡¹ç›®ç¯å¢ƒ
***
1. **ffmpeg ç‰ˆæœ¬: ffmpeg-master-latest-win64-gpl**
2. **rtsp-server (æ¨æµæœåŠ¡å™¨)ç‰ˆæœ¬: rtsp-simple-server_v0.21.6_windows_amd64**
3. **java ç‰ˆæœ¬: 1.8**
4. **mysql ç‰ˆæœ¬: 8.0**
***
&emsp;**å…¶ä½™ç»„ä»¶è§ pom.xml**

# äº”ã€å¯åŠ¨æµç¨‹
## 1ã€å¯åŠ¨ rtsp-simple-server ä¸­çš„ rtsp-simple-server.exeã€‚
&emsp;**æ–¹æ³•1ï¼šæ‰§è¡Œä¸‹è¿°å‘½ä»¤ï¼Œè¿è¡Œ(æ¨èï¼Œå› ä¸ºæ— éœ€è‡ªå·±åœ¨å»æ–‡ä»¶å¤¹ç‚¹å‡»)ã€‚**
```shell
.\PushFlowUtil\rtsp-simple-server\rtsp-simple-server.exe .\PushFlowUtil\rtsp-simple-server\rtsp-simple-server.yml
```
&emsp;**æ–¹æ³•2ï¼š åœ¨æ“ä½œç³»ç»Ÿçš„ç›®å½•ä¸­ç‚¹å‡»exeæ–‡ä»¶è¿è¡Œ(ä¸æ¨èï¼Œéœ€è¦è‡ªå·±è¿›å…¥åˆ°æ–‡ä»¶ç›®å½•ä¸­ç‚¹å‡»è¿è¡Œï¼Œæ³¨æ„ä¸‹è¿°è­¦å‘Š)ã€‚**

&emsp;**ï¼è­¦å‘Šï¼šåœ¨ideaçš„æ–‡ä»¶å¤¹ä¸­ï¼Œç›´æ¥ç‚¹å‡»exeæ–‡ä»¶è¿è¡Œä¼šå‡ºç°è¯»å–ä¸åˆ°é…ç½®æ–‡ä»¶çš„å¼‚å¸¸æƒ…å†µï¼Œæ‰€ä»¥ä¸è¦è¿™æ ·æ“ä½œï¼**

![å¯åŠ¨æµç¨‹1](ReadMeImages/InitiateProcess_1.png)

![å¯åŠ¨æˆåŠŸ](ReadMeImages/InitiateProcess_2.png)
## 2ã€ä½¿ç”¨FFmpegå¯¹æœ¬åœ°è§†é¢‘æ¨æµ
ï¼**æ³¨æ„ï¼šéœ€è¦å…ˆè§£å‹biné‡Œçš„å‹ç¼©åŒ…ï¼Œå–å‡ºå…¶ä¸­çš„ffmpeg.exeåˆ°binä¸‹ï¼Œå†å°†ffmpeg/binç›®å½•é…ç½®åˆ°ç¯å¢ƒå˜é‡ä¸­ï¼Œå†è¿›è¡Œæ¨æµæ“ä½œ**

æ¨é€æœ¬åœ°æ‘„åƒå¤´ï¼Œrtspæµ ã€æ³¨æ„ä¿®æ”¹å‚æ•°ã€‘
```shell
ffmpeg -f dshow -i video="ov9734_azurewave_camera" -vcodec libx264 -r 30 -f rtsp rtsp://127.0.0.1:8554/live
```
æ¨é€æœ¬åœ°æ‘„åƒå¤´ï¼Œrtmpæµ ã€æ³¨æ„ä¿®æ”¹å‚æ•°ã€‘
```shell
ffmpeg -f dshow -i video="ov9734_azurewave_camera" -framerate 25 -bufsize 1000000k -vcodec libx264 -preset:v ultrafast -tune:v zerolatency -an -f flv rtmp://127.0.0.1:1935/live
```
æ¨é€æœ¬åœ°è§†é¢‘ï¼Œrtmpæµï¼Œæ­¤å¤„è§†é¢‘ä¸­æ²¡æœ‰ç«ç„°ã€æ³¨æ„ä¿®æ”¹å‚æ•°ã€‘ã€‚
```shell
ffmpeg -re -stream_loop -1 -i .\src\main\resources\systemTestData\pushFlowTestVideos\liveVideoNoFire.mp4 -vcodec copy -an -f flv -y rtmp://127.0.0.1:1935/live2
```
æ¨é€æœ¬åœ°è§†é¢‘ï¼Œrtmpæµï¼Œæ­¤å¤„è§†é¢‘ä¸­æœ‰ç«ç„° ã€æ³¨æ„ä¿®æ”¹å‚æ•°ã€‘ã€‚
```shell
ffmpeg -re -stream_loop -1 -i .\src\main\resources\systemTestData\pushFlowTestVideos\liveVideoHasFire.mp4 -vcodec copy -an -f flv -y rtmp://127.0.0.1:1935/live1
```
&emsp;**æ³¨æ„ï¼šæ¨æµçš„è§†é¢‘åœ°å€ä¸ºç»å¯¹è·¯å¾„ã€‚å¦‚æœéœ€è¦æ¨æµæ‘„åƒå¤´æ³¨æ„æ›´æ”¹æ‘„åƒå¤´åç§°å‚æ•°**

<img alt="æ¨æµ" height="623" src="ReadMeImages/InitiateProcess_3.png" width="1110"/>

## 3ã€å¯åŠ¨é¡¹ç›®

<img alt="å¯åŠ¨é¡¹ç›®" src="ReadMeImages/InitiateProcess_4.png" title="å¯åŠ¨é¡¹ç›®"/>

# å…­ã€åŠŸèƒ½å±•ç¤º
## 1ã€ç›‘æ§åŠç«æƒ…è­¦æŠ¥
### ï¼ˆ1ï¼‰ ç›‘æ§é¡µé¢

<img alt="ç›‘æ§é¡µé¢" src="ReadMeImages/monitoringLargeScreen.png" title="ç›‘æ§é¡µé¢"/>

### ï¼ˆ2ï¼‰ è­¦æŠ¥åŠŸèƒ½
&emsp;- **ç›‘æ§å¤§å±å¤„æŠ¥è­¦**

<img alt="è­¦æŠ¥åŠŸèƒ½_1" src="ReadMeImages/flameAlarm_1.png" title="è­¦æŠ¥åŠŸèƒ½_1"/>

&emsp;- **é’‰é’‰æŠ¥è­¦**

<img alt="è­¦æŠ¥åŠŸèƒ½_2" src="ReadMeImages/flameAlarm_2.png" title="é’‰é’‰æŠ¥è­¦"/>

## 2ã€åŸºæœ¬ä¿¡æ¯ç®¡ç†
### ï¼ˆ1ï¼‰ç›‘æ§è®¾å¤‡ä¿¡æ¯ç®¡ç†

<img alt="ç›‘æ§è®¾å¤‡ä¿¡æ¯ç®¡ç†" src="ReadMeImages/monitorInfo.png" title="ç›‘æ§è®¾å¤‡ä¿¡æ¯ç®¡ç†"/>

### ï¼ˆ2ï¼‰å†å²ç›‘æ§ä¿¡æ¯ç®¡ç†

<img alt="å†å²ç›‘æ§ä¿¡æ¯ç®¡ç†" src="ReadMeImages/historicalMonitoringInfo.png" title="å†å²ç›‘æ§ä¿¡æ¯ç®¡ç†"/>

### ï¼ˆ3ï¼‰å°åŒºä½å®…ä¿¡æ¯ç®¡ç†
&emsp;&emsp;**è¯´æ˜ï¼šä¸å…è®¸è¯¥é¡µé¢å¯¹ä½å®…ä¿¡æ¯çš„åŸºæœ¬éƒ¨åˆ†åšä¿®æ”¹ï¼Œå› ä¸ºè€ƒè™‘åˆ°è¿™éƒ¨åˆ†ä¿¡æ¯ä¼šåœ¨é¡¹ç›®ä¹‹å‰å­˜åœ¨ä¸”å…·æœ‰é‡è¦æ€§ã€å›ºå®šæ€§ï¼Œæ‰€ä»¥åªå…è®¸ç®¡ç†å‘˜åœ¨æ­¤å¤„ä¿®æ”¹ä½æˆ·ä¿¡æ¯**

<img alt="å°åŒºä½å®…ä¿¡æ¯ç®¡ç†" src="ReadMeImages/residentialInfo.png" title="å°åŒºä½å®…ä¿¡æ¯ç®¡ç†"/>

### ï¼ˆ4ï¼‰æ¶ˆé˜²è®¾å¤‡ä¿¡æ¯ç®¡ç†

<img alt="æ¶ˆé˜²è®¾å¤‡ä¿¡æ¯ç®¡ç†" src="ReadMeImages/fireEquipmentInfo.png" title="æ¶ˆé˜²è®¾å¤‡ä¿¡æ¯ç®¡ç†"/>

### ï¼ˆ5ï¼‰ç«æƒ…è´Ÿè´£äººä¿¡æ¯ç®¡ç†
<img alt="ç«æƒ…è´Ÿè´£äººä¿¡æ¯ç®¡ç†" src="ReadMeImages/managerinfo.png" title="ç«æƒ…è´Ÿè´£äººä¿¡æ¯ç®¡ç†"/>

### ï¼ˆ6ï¼‰æ—¥å¿—ä¿¡æ¯ç®¡ç†ï¼ˆç”¨æˆ·æ“ä½œæ—¥å¿—ï¼Œç«æƒ…è­¦æŠ¥æ—¥å¿—ï¼‰
&emsp;- **ç”¨æˆ·æ“ä½œæ—¥å¿—**

<img alt="ç”¨æˆ·æ“ä½œæ—¥å¿—" src="ReadMeImages/userLog.png" title="ç”¨æˆ·æ“ä½œæ—¥å¿—"/>

&emsp;- **ç«æƒ…è­¦æŠ¥æ—¥å¿—**

<img alt="ç«æƒ…è­¦æŠ¥æ—¥å¿—" src="ReadMeImages/fireLog.png" title="ç«æƒ…è­¦æŠ¥æ—¥å¿—"/>

# ä¸ƒã€ç–‘éš¾é—®é¢˜
&emsp;**è¯¥éƒ¨åˆ†è®°å½•äº†é¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­é‡åˆ°çš„å½¢å½¢è‰²è‰²çš„é—®é¢˜ã€‚**
### 1.åœ¨è®­ç»ƒæ¨¡å‹æ—¶ï¼Œéœ€è¦å®‰è£… pytorchï¼Œä½†æ˜¯å®‰è£…åæ£€æŸ¥å®‰è£…æ˜¯å¦æˆåŠŸå´ä¸€ç›´False
>é—®é¢˜å‡ºç°åŸå› æ˜¯æ¸…åæºé•œåƒæ²¡æœ‰GPUç‰ˆæœ¬ï¼Œå¯¼è‡´å®é™…ä¸‹è½½çš„æ˜¯CPUç‰ˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨ conde list æŸ¥çœ‹ã€‚æ‰€ä»¥å¯ä»¥å»[å®˜ç½‘](https://pytorch.org/get-started/previous-versions/)å¯»æ‰¾ä¸cudaå¯¹åº”ç‰ˆæœ¬çš„pytorch
<br>å¦‚: cuda 10.1<br>
<img src="ReadMeImages/question_1.png" width ="1000px" height ="500px" title="cuda 10.1" alt="cuda 10.1">


### 2.Vueä¸­thiså…³é”®å­—æŒ‡å‘
&emsp;ajaxçš„å›è°ƒå‡½æ•°éœ€è¦ç”¨ç®­å¤´å‡½æ•°ï¼Œå¦åˆ™thiså…³é”®å­—æŒ‡å‘çš„ä¸æ˜¯vueï¼Œè¯¦è§ [åšå®¢: vueä¸­thisæŒ‡å‘é—®é¢˜JingG459çš„åšå®¢](https://blog.csdn.net/JINGinC/article/details/120926465)
æˆ–è€…è®°ä½ **JavaScriptä¸­thiså…³é”®å­—æ°¸è¿œæŒ‡å‘çš„æ˜¯å‡½æ•°è°ƒç”¨è€…**ã€‚

### 3.ä½¿ç”¨spring-securityæ—¶ï¼Œå‡ºç°403é—®é¢˜----è·¨åŸŸé—®é¢˜
å¦‚æœä½¿ç”¨ spring-securityï¼Œé»˜è®¤å¼€å¯äº†é˜²æ­¢è·¨åŸŸæ”»å‡»çš„åŠŸèƒ½ï¼Œä»»ä½• POST æäº¤åˆ°åå°çš„è¡¨å•éƒ½è¦éªŒè¯æ˜¯å¦å¸¦æœ‰ _csrf å‚æ•°ï¼Œä¸€æ—¦ä¼ æ¥çš„ _csrf å‚æ•°ä¸æ­£ç¡®ï¼ŒæœåŠ¡å™¨ä¾¿è¿”å› 403 é”™è¯¯ï¼›<br>
[å‚è€ƒåšå®¢](https://blog.csdn.net/shawearn1027/article/details/71119587#:~:text=%E4%BD%BF%E7%94%A8%E4%BA%86%20spring-security%20%E5%90%8E%EF%BC%8C%E9%BB%98%E8%AE%A4%E5%BC%80%E5%90%AF%E4%BA%86%E9%98%B2%E6%AD%A2%E8%B7%A8%E5%9F%9F%E6%94%BB%E5%87%BB%E7%9A%84%E5%8A%9F%E8%83%BD%EF%BC%8C%E4%BB%BB%E4%BD%95%20POST%20%E6%8F%90%E4%BA%A4%E5%88%B0%E5%90%8E%E5%8F%B0%E7%9A%84%E8%A1%A8%E5%8D%95%E9%83%BD%E8%A6%81%E9%AA%8C%E8%AF%81%E6%98%AF%E5%90%A6%E5%B8%A6%E6%9C%89%20_csrf%20%E5%8F%82%E6%95%B0%EF%BC%8C%E4%B8%80%E6%97%A6%E4%BC%A0%E6%9D%A5%E7%9A%84%20_csrf,%E5%8F%82%E6%95%B0%E4%B8%8D%E6%AD%A3%E7%A1%AE%EF%BC%8C%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BE%BF%E8%BF%94%E5%9B%9E%20403%20%E9%94%99%E8%AF%AF%EF%BC%9B%20%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E4%B8%80%EF%BC%9A%20form%20%E8%A1%A8%E5%8D%95%E4%B8%AD%E6%B7%BB%E5%8A%A0%20_csrf%20%E9%9A%90%E8%97%8F%E5%9F%9F)

### 4.Springbootå®ç°å¯ä»¥ç›´æ¥è®¿é—®Templatesä¸‹çš„htmlæ–‡ä»¶
```xml
spring:
 resources:
   static-locations: classpath:/META-INF/resources/,classpath:/resources/,classpath:/static/,classpath:/public/,classpath:/templates/
```
### 5.springbootæµ‹è¯•æ—¶beanå¯¹è±¡ç©ºæŒ‡é’ˆå¼‚å¸¸
@Testå¼•å…¥çš„åŒ…æœ‰é—®é¢˜ï¼Œå¼•å…¥ä¸‹é¢çš„åŒ…ã€‚
```java
import org.junit.jupiter.api.Test;
```

### 6.çˆ¶é¡µé¢å‘iframeä¼ é€’æ•°æ®

&emsp;æ–¹æ³•ä¸€ï¼ˆæ¨èï¼Œç›¸è¾ƒäºæ–¹æ³•äºŒå¯ä»¥æŠŠå‚æ•°ä¼ å‡ºï¼Œåœ¨å­é¡µé¢å…¨å±€ä½¿ç”¨ï¼‰:
```html
<!--çˆ¶é¡µé¢-->
<iframe class="tosearchvideo" src="" style="width: 100%;height: 100%;border: 0;"></iframe>
<!--jsä¿®æ”¹srcä¸ºxxx.html?data=xxx&data1=xxx-->
```
```javascript
//å­iframeé¡µé¢jsï¼š
//è·å–?åçš„æ•°æ®
function GetRequest() {
    const url = location.search; //è·å–urlä¸­"?"ç¬¦åçš„å­—ä¸²
    let theRequest = {};
    if (url.indexOf("?") !== -1) {
        const str = url.substr(1);
        const strs = str.split("&");
        for (var i = 0; i < strs.length; i++) {
            theRequest[strs[i].split("=")[0]] = unescape(strs[i].split("=")[1]);
        }
    }
    return theRequest;
}

var data1 = GetRequest()['data1'];
console.log(data1);
```
&emsp;æ–¹æ³•äºŒ(æ²¡åŠæ³•å°†å‚æ•°ä¼ å‡º,å¦‚æœåªæ˜¯ç®€å•çš„æ‰§è¡ŒåŠ¨ä½œå¯ä»¥ç”¨)ï¼š
```js
// çˆ¶é¡µé¢jsï¼š
const frame = document.getElementsByClassName('tosearchvideo')[0];
frame.contentWindow.postMessage(data, '*'); //dataä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡

// å­é¡µé¢js:
window.addEventListener('message', function (event) {
        //event.dataè·å–ä¼ è¿‡æ¥çš„æ•°æ®
        const data = event.data;
    });
```

### 7.Springbooté¡¹ç›®å…³é—­æ—¶,èµ„æºçš„é‡Šæ”¾
[å‚è€ƒåšå®¢](https://my.oschina.net/evermaze/blog/1594330)

### 8.Mybatis-Pluså®ç°å¯¹æŒ‡å®šå­—æ®µåŠ å¯†è§£å¯†
[å‚è€ƒåšå®¢](https://juejin.cn/post/6963811586184052767)

# å…«ã€æœ€ç»ˆæ€»ç»“
&emsp;æˆªè‡³2023å¹´4æœˆ27æ—¥ï¼Œæœ¬é¡¹ç›®åŸºæœ¬å®Œæˆã€‚é¡¹ç›®å®Œæˆäº†åˆæœŸè®¾è®¡çš„åŸºæœ¬åŠŸèƒ½ï¼Œä½†ä»å­˜åœ¨è¯¸å¤šé—®é¢˜ã€‚

&emsp;é—®é¢˜1ï¼šè¿™æ˜¯æœ€ä¸»è¦çš„é—®é¢˜ï¼Œå³è§†é¢‘æµä¸ç«ç„°æ£€æµ‹éƒ¨åˆ†ï¼Œç›®å‰é‡‡å–çš„æ–¹æ¡ˆæ˜¯é€šè¿‡ffmpegæˆªå–è§†é¢‘æµçš„æŸä¸€å¸§è·å–å›¾ç‰‡ï¼Œå†è¯»å–å›¾ç‰‡è¿›è¡Œæ£€æµ‹ã€‚
YOLOv5å®é™…æ”¯æŒå¯¹rtmpè§†é¢‘æµçš„æ£€æµ‹ï¼Œ<br>ä½†åœ¨å®é™…æµ‹è¯•æ—¶ï¼Œå‘ç°ç›´æ¥æ£€æµ‹å»¶è¿Ÿè¾ƒé«˜ï¼Œæ•ˆæœä¸å¦‚äººæ„ï¼Œå› æ­¤é‡‡ç”¨äº†ç›®å‰çš„æ–¹æ¡ˆã€‚è€Œç›®å‰çš„æ–¹æ¡ˆæœ€å¤§çš„é—®é¢˜æ˜¯é‡‡ç”¨æ“ä½œç³»ç»Ÿä¸­ffmpegç¨‹åºå®Œæˆçš„å›¾ç‰‡æˆªå–ï¼Œæ‰€ä»¥æ¯ä¸€ä¸ªç›‘æ§è®¾å¤‡å°±ä¼š<br>å¯¹åº”ä¸€ä¸ªç³»ç»Ÿè¿›ç¨‹ï¼Œ
æå¤§çš„å ç”¨ç³»ç»Ÿå†…å­˜ï¼ˆæ‰€ä»¥è¿è¡Œåä¼šæ„Ÿè§‰ç”µè„‘å¾ˆå¡é¡¿ï¼‰ã€‚å½“ç„¶ï¼Œjavaä¸­ä¹Ÿå­˜åœ¨ffmpegå¯¹åº”çš„api,ä½†æ˜¯é—®é¢˜ä¾ç„¶æ˜¯å»¶è¿Ÿå¤ªé«˜ï¼Œæ•ˆæœå·®ï¼Œå¹¶ä¸”å½“æ¨æµçš„æºæ˜¯æ‘„åƒå¤´æ—¶ï¼Œå»º<br>ç«‹è¿æ¥çš„æ—¶é—´ä¹Ÿå¾ˆé•¿ï¼Œæ‰€ä»¥æ²¡æœ‰é‡‡ç”¨apiçš„æ–¹å¼ã€‚

&emsp;é—®é¢˜2ï¼šåœ¨è­¦æŠ¥æ—¶å¯¹æ¶ˆé˜²è®¾å¤‡çš„æŸ¥è¯¢ç›®å‰å®ç°çš„è¾ƒä¸ºç®€å•ï¼Œåªæ˜¯æŸ¥è¯¢è·Ÿç›‘æ§è®¾å¤‡åŒä¸€ä½ç½®çš„è®¾å¤‡ä¿¡æ¯ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å…¶ä»–æ–¹å¼æŸ¥è¯¢é™„è¿‘èŒƒå›´çš„æ‰€æœ‰è®¾å¤‡ã€‚

&emsp;**... ...**
<br>
***
<div style="text-align: center;"><span   style="color: #f0ffff; font-size: x-large; font-family: 'Microsoft YaHei UI',serif; ">End.</span></div>

